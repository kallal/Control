Version =20
VersionRequired =20
PublishOption =1
Checksum =-2090644165
Begin Form
    RecordSelectors = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    ScrollBars =0
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridX =24
    GridY =24
    Width =7770
    DatasheetFontHeight =11
    ItemSuffix =41
    Left =1890
    Top =450
    Right =9750
    Bottom =8595
    DatasheetGridlinesColor =16446942
    RecSrcDt = Begin
        0x774d5c1e928be440
    End
    GUID = Begin
        0x648da8db9daf5d47870c9d67e4681275
    End
    NameMap = Begin
        0x0acc0e5500000000abd7a13a18cfc44f845c77c762d61a46000000004ab495dd ,
        0x748ae4400000000000000000640062006f005f0043006f006e00740061006300 ,
        0x74004e0061006d00650000000000000000000000000000000000000000000000 ,
        0x0700000000000000000000000000000000000000490073005700650062004100 ,
        0x6300740069007600650000000000000000000000000000000000000000000000 ,
        0x0700000000000000000000000000000000000000500061007300730077006f00 ,
        0x720064004800610073006800000000000000514e506f3a592749b1a668828ff5 ,
        0x5adf000000004ba14137928be4400000000000000000640062006f005f005700 ,
        0x650062005f0052006f006c00650073000000000000007c1dcad0c598584ea48b ,
        0x0f8f4c39234d07000000514e506f3a592749b1a668828ff55adf490044000000 ,
        0x000000002be861695870624b818daef83bcf62a007000000514e506f3a592749 ,
        0xb1a668828ff55adf52006f006c0065004e0061006d0065000000000000008974 ,
        0x8daf5ac3b24491fdc362eee3916507000000514e506f3a592749b1a668828ff5 ,
        0x5adf4400650073006300720069007000740069006f006e000000000000000000 ,
        0x00000000000000000000000000000c0000000500000000000000000000000000 ,
        0x00000000
    End
    RecordSource ="SELECT dbo_ContactName.* FROM dbo_ContactName; "
    Caption ="Web Portal user Settings"
    DatasheetFontName ="Calibri"
    PrtMip = Begin
        0x6801000068010000680100006801000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    PrtDevMode = Begin
        0x0072902f0400000001000000ac44e400120000002047e400d444e400a0a57c38 ,
        0x010401069c003c0303df00000100010000000000000001000700580201000100 ,
        0x5802000000000000c80c6e060c47e400c40c6e060445e400e188b72fe00c6e06 ,
        0xe888b72f171d0000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000000000000000000000000000000000005344444d ,
        0x03050000030500004850204c617365724a657420313032300000000000000000 ,
        0x0000000000000000000000000000000000000000010000000000000001000000 ,
        0x0000000000000000010000000100000001000000010000000100000001000000 ,
        0x0100000001000000010000000100000001000000010000000100000001000000 ,
        0x010000000100000001000000010000000000000001000000010000001a040000 ,
        0x0000000000000000000000000f0000005a000000000000000000000001000000 ,
        0x000000000000000080808000ff000000ffff000000ff000000ffff000000ff00 ,
        0xff00ff0000000000000000000000000000000000280000006400000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x00000000000000000000000000000000de030000de0300000000000000000000 ,
        0x0080000000000000000000000100000000000000000000000000000000000000 ,
        0x000000000000000000000000620bf25f3c030000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000000000000000000000000000
    End
    PrtDevNames = Begin
        0x080019002a000100000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000055534230303100000000000000000000000000000000 ,
        0x00000000000000000000000000
    End
    OnLoad ="[Event Procedure]"
    AllowDatasheetView =0
    AllowPivotTableView =0
    AllowPivotChartView =0
    AllowPivotChartView =0
    FilterOnLoad =0
    ShowPageMargins =0
    DisplayOnSharePointSite =1
    DatasheetAlternateBackColor =15921906
    DatasheetGridlinesColor12 =0
    FitToScreen =1
    DatasheetBackThemeColorIndex =1
    BorderThemeColorIndex =3
    ThemeFontIndex =1
    ForeThemeColorIndex =0
    AlternateBackThemeColorIndex =1
    AlternateBackShade =95.0
    PrtDevModeW = Begin
        0x0000e5009b06552f0000000060f14375454905aafeffffff3882e501c0005406 ,
        0xc873aa2f09000000c8ade50100000000000000005b0300000815540601000000 ,
        0x01040106dc003c0303df00000100010000000000000001000700580201000100 ,
        0x580200000000000000000000520300001f000000c00054067f00000060025406 ,
        0x320000000000850e2486e50060800b7760fc15aafefffffffc82e50054130677 ,
        0x3c00000048000000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000000000000000000000000000000000005344444d ,
        0x03050000030500004850204c617365724a657420313032300000000000000000 ,
        0x0000000000000000000000000000000000000000010000000000000001000000 ,
        0x0000000000000000010000000100000001000000010000000100000001000000 ,
        0x0100000001000000010000000100000001000000010000000100000001000000 ,
        0x010000000100000001000000010000000000000001000000010000001a040000 ,
        0x0000000000000000000000000f0000005a000000000000000000000001000000 ,
        0x000000000000000080808000ff000000ffff000000ff000000ffff000000ff00 ,
        0xff00ff0000000000000000000000000000000000280000006400000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x00000000000000000000000000000000de030000de0300000000000000000000 ,
        0x0080000000000000000000000100000000000000000000000000000000000000 ,
        0x000000000000000000000000620bf25f3c030000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000000000000000000000000000
    End
    PrtDevNamesW = Begin
        0x0400150026000100000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000005500530042003000300031000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x000000000000000000000000000000000000
    End
    NoSaveCTIWhenDisabled =1
    NoSaveCTIWhenDisabled =1
    Begin
        Begin Label
            BackStyle =0
            FontSize =11
            FontName ="Calibri"
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =0
            BorderTint =50.0
            ForeThemeColorIndex =0
            ForeTint =50.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin CommandButton
            FontSize =11
            FontWeight =400
            FontName ="Calibri"
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
            UseTheme =1
            Shape =1
            Gradient =12
            BackThemeColorIndex =4
            BackTint =60.0
            BorderLineStyle =0
            BorderColor =16777215
            BorderThemeColorIndex =4
            BorderTint =60.0
            ThemeFontIndex =1
            HoverThemeColorIndex =4
            HoverTint =40.0
            PressedThemeColorIndex =4
            PressedShade =75.0
            HoverForeThemeColorIndex =0
            HoverForeTint =75.0
            PressedForeThemeColorIndex =0
            PressedForeTint =75.0
        End
        Begin CheckBox
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
            BorderThemeColorIndex =1
            BorderShade =65.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin TextBox
            AddColon = NotDefault
            FELineBreak = NotDefault
            BorderLineStyle =0
            LabelX =-1800
            FontSize =11
            FontName ="Calibri"
            AsianLineBreak =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ThemeFontIndex =1
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin ListBox
            BorderLineStyle =0
            LabelX =-1800
            FontSize =11
            FontName ="Calibri"
            AllowValueListEdits =1
            InheritValueList =1
            ThemeFontIndex =1
            BackThemeColorIndex =1
            BorderThemeColorIndex =1
            BorderShade =65.0
            ForeThemeColorIndex =0
            ForeTint =75.0
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin EmptyCell
            Height =240
            GridlineColor =12632256
            GridlineThemeColorIndex =1
            GridlineShade =65.0
        End
        Begin FormHeader
            Height =2085
            BackColor =15527148
            Name ="FormHeader"
            GUID = Begin
                0xac1c6dc5829ad142abc72a70ac0b22da
            End
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            Begin
                Begin Label
                    OverlapFlags =85
                    Left =90
                    Top =135
                    Width =2970
                    Height =390
                    FontSize =14
                    FontWeight =700
                    BorderColor =8355711
                    Name ="Label0"
                    Caption ="Web Portal Settings"
                    FontName ="Arial"
                    GUID = Begin
                        0x22542db3ebd6dd4fb0f3bd3955060055
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =90
                    LayoutCachedTop =135
                    LayoutCachedWidth =3060
                    LayoutCachedHeight =525
                    ThemeFontIndex =-1
                    ForeTint =100.0
                End
                Begin TextBox
                    OverlapFlags =85
                    TextAlign =1
                    IMESentenceMode =3
                    Left =3435
                    Top =1335
                    Width =3870
                    Height =330
                    ColumnOrder =0
                    FontSize =12
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="txtLastFile"
                    FontName ="Arial"
                    GUID = Begin
                        0x911c17050a52ee479b89b9cc989a0b58
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =3435
                    LayoutCachedTop =1335
                    LayoutCachedWidth =7305
                    LayoutCachedHeight =1665
                    ThemeFontIndex =-1
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextAlign =3
                            Left =1035
                            Top =1335
                            Width =2205
                            Height =330
                            FontSize =12
                            BorderColor =8355711
                            Name ="Label9"
                            Caption ="Last File Upload:"
                            FontName ="Arial"
                            GUID = Begin
                                0x1eef1ffc0570674eb56dfa9c4f62b6d7
                            End
                            GridlineColor =10921638
                            LayoutCachedLeft =1035
                            LayoutCachedTop =1335
                            LayoutCachedWidth =3240
                            LayoutCachedHeight =1665
                            ThemeFontIndex =-1
                            ForeTint =100.0
                        End
                    End
                End
                Begin TextBox
                    OverlapFlags =85
                    TextAlign =3
                    IMESentenceMode =3
                    Left =3435
                    Top =945
                    Width =3870
                    Height =330
                    ColumnOrder =2
                    FontSize =12
                    TabIndex =1
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="txtLastUpload"
                    FontName ="Arial"
                    GUID = Begin
                        0xff0e5b357a6de9459cdf37548eb6d6bb
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =3435
                    LayoutCachedTop =945
                    LayoutCachedWidth =7305
                    LayoutCachedHeight =1275
                    ThemeFontIndex =-1
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextAlign =3
                            Left =1065
                            Top =945
                            Width =2205
                            Height =330
                            FontSize =12
                            BorderColor =8355711
                            Name ="Label4"
                            Caption ="Last Upload Date:"
                            FontName ="Arial"
                            GUID = Begin
                                0xdfe3169ec38e3c49807fb5661d895492
                            End
                            GridlineColor =10921638
                            LayoutCachedLeft =1065
                            LayoutCachedTop =945
                            LayoutCachedWidth =3270
                            LayoutCachedHeight =1275
                            ThemeFontIndex =-1
                            ForeTint =100.0
                        End
                    End
                End
                Begin TextBox
                    OverlapFlags =85
                    TextAlign =3
                    IMESentenceMode =3
                    Left =3435
                    Top =570
                    Width =3870
                    Height =330
                    ColumnOrder =1
                    FontSize =12
                    TabIndex =2
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="txtLastSeen"
                    FontName ="Arial"
                    GUID = Begin
                        0xf28c80c5cb869d43a261c134f8968d94
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =3435
                    LayoutCachedTop =570
                    LayoutCachedWidth =7305
                    LayoutCachedHeight =900
                    ThemeFontIndex =-1
                    Begin
                        Begin Label
                            OverlapFlags =85
                            TextAlign =3
                            Left =1050
                            Top =570
                            Width =2190
                            Height =330
                            FontSize =12
                            BorderColor =8355711
                            Name ="Label3"
                            Caption ="Last seen:"
                            FontName ="Arial"
                            GUID = Begin
                                0x70fe48451797274d89cb67f42e9b8d77
                            End
                            GridlineColor =10921638
                            LayoutCachedLeft =1050
                            LayoutCachedTop =570
                            LayoutCachedWidth =3240
                            LayoutCachedHeight =900
                            ThemeFontIndex =-1
                            ForeTint =100.0
                        End
                    End
                End
                Begin TextBox
                    OverlapFlags =85
                    BackStyle =0
                    IMESentenceMode =3
                    Left =3210
                    Top =135
                    Width =4095
                    Height =390
                    ColumnOrder =3
                    FontSize =14
                    TabIndex =3
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="txtFullName"
                    ControlSource ="=([FN]+' '+[LN])"
                    FontName ="Arial"
                    GUID = Begin
                        0x9fedc305a6eebf4b881d9f328e6ecc95
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =3210
                    LayoutCachedTop =135
                    LayoutCachedWidth =7305
                    LayoutCachedHeight =525
                    ThemeFontIndex =-1
                End
            End
        End
        Begin Section
            Height =6195
            Name ="Detail"
            GUID = Begin
                0x53763951e89b864b8b57712e3f7b4ae2
            End
            AlternateBackColor =15921906
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =1
            Begin
                Begin CheckBox
                    OverlapFlags =85
                    Left =2115
                    Top =405
                    BorderColor =10921638
                    Name ="chkIsPortalUser"
                    ControlSource ="IsWebActive"
                    AfterUpdate ="[Event Procedure]"
                    GUID = Begin
                        0x3ddeb74c8089c7498157e3ff4333735b
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =2115
                    LayoutCachedTop =405
                    LayoutCachedWidth =2375
                    LayoutCachedHeight =645
                    Begin
                        Begin Label
                            OverlapFlags =85
                            Left =570
                            Top =360
                            Width =1410
                            Height =285
                            BorderColor =8355711
                            Name ="Label29"
                            Caption ="Can Use Portal"
                            GUID = Begin
                                0x816603c7ab9cd34a99d83db408497f35
                            End
                            GridlineColor =10921638
                            LayoutCachedLeft =570
                            LayoutCachedTop =360
                            LayoutCachedWidth =1980
                            LayoutCachedHeight =645
                            ForeTint =100.0
                        End
                    End
                End
                Begin Label
                    BackStyle =1
                    OverlapFlags =85
                    Left =2895
                    Top =225
                    Width =3390
                    Height =555
                    BorderColor =8355711
                    Name ="txtPortalActive"
                    Caption ="Must be Checked to allow user logon to Portal"
                    GUID = Begin
                        0x0b2889a60940e7438ac2b7d63913c612
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =2895
                    LayoutCachedTop =225
                    LayoutCachedWidth =6285
                    LayoutCachedHeight =780
                    BackThemeColorIndex =-1
                    ForeTint =100.0
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =510
                    Top =1035
                    Width =1830
                    Height =450
                    TabIndex =1
                    ForeColor =4210752
                    Name ="cmdPassReset"
                    Caption ="Password Reset"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x0a1b6521b41d734281c79e45205f3042
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =510
                    LayoutCachedTop =1035
                    LayoutCachedWidth =2340
                    LayoutCachedHeight =1485
                    BackColor =14732154
                    BorderColor =14732154
                    HoverColor =15392166
                    PressedColor =9402914
                    HoverForeColor =4210752
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                End
                Begin Label
                    BackStyle =1
                    OverlapFlags =85
                    Left =2895
                    Top =975
                    Width =3360
                    Height =825
                    BorderColor =8355711
                    Name ="Label32"
                    Caption ="Will reset their password\015\012(resets password to their email)"
                    GUID = Begin
                        0x7cd7da7ba69cff4dae9bb7fe04fae68c
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =2895
                    LayoutCachedTop =975
                    LayoutCachedWidth =6255
                    LayoutCachedHeight =1800
                    BackThemeColorIndex =-1
                    ForeTint =100.0
                End
                Begin TextBox
                    OverlapFlags =85
                    IMESentenceMode =3
                    Left =2895
                    Top =2025
                    Width =4410
                    Height =390
                    FontSize =14
                    TabIndex =2
                    BorderColor =10921638
                    ForeColor =4210752
                    Name ="txtShowPassword"
                    ControlSource ="PasswordHash"
                    GUID = Begin
                        0xdd75882d06d6f244bdadad9b171c5634
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =2895
                    LayoutCachedTop =2025
                    LayoutCachedWidth =7305
                    LayoutCachedHeight =2415
                    Begin
                        Begin Label
                            OverlapFlags =85
                            Left =1065
                            Top =2025
                            Width =1755
                            Height =345
                            FontSize =12
                            BorderColor =8355711
                            ForeColor =8355711
                            Name ="Label39"
                            Caption ="User password = "
                            GUID = Begin
                                0xdf54af65370aff428c758ee2b19d4cf6
                            End
                            GridlineColor =10921638
                            LayoutCachedLeft =1065
                            LayoutCachedTop =2025
                            LayoutCachedWidth =2820
                            LayoutCachedHeight =2370
                        End
                    End
                End
                Begin Label
                    OverlapFlags =85
                    Left =465
                    Top =2805
                    Width =2970
                    Height =390
                    FontSize =12
                    FontWeight =700
                    BorderColor =8355711
                    Name ="Label36"
                    Caption ="Web Portal Options"
                    FontName ="Arial"
                    GUID = Begin
                        0xd21c02cb46fa4242b9a9c98cb9f571fa
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =465
                    LayoutCachedTop =2805
                    LayoutCachedWidth =3435
                    LayoutCachedHeight =3195
                    ThemeFontIndex =-1
                    ForeTint =100.0
                End
                Begin ListBox
                    ColumnHeads = NotDefault
                    SpecialEffect =4
                    OverlapFlags =85
                    MultiSelect =1
                    BorderWidth =3
                    IMESentenceMode =3
                    ColumnCount =3
                    Left =465
                    Top =3345
                    Width =6870
                    Height =2370
                    TabIndex =3
                    ForeColor =4210752
                    BorderColor =10921638
                    Name ="lstSecurity"
                    RowSourceType ="Table/Query"
                    RowSource ="SELECT dbo_Web_Roles.ID, dbo_Web_Roles.RoleName, dbo_Web_Roles.Description FROM "
                        "dbo_Web_Roles ORDER BY dbo_Web_Roles.ID; "
                    ColumnWidths ="0;1728;2880"
                    AfterUpdate ="[Event Procedure]"
                    GUID = Begin
                        0xa30be9312a3fa7459f9b99b2417998cb
                    End
                    GridlineColor =10921638
                    AllowValueListEdits =0
                    LayoutCachedLeft =465
                    LayoutCachedTop =3345
                    LayoutCachedWidth =7335
                    LayoutCachedHeight =5715
                End
            End
        End
        Begin FormFooter
            Height =945
            Name ="FormFooter"
            GUID = Begin
                0x2aa958358e8a414f8660211490e14654
            End
            AlternateBackThemeColorIndex =1
            AlternateBackShade =95.0
            BackThemeColorIndex =1
            Begin
                Begin CommandButton
                    OverlapFlags =85
                    Left =6255
                    Top =120
                    Width =1020
                    Height =600
                    ForeColor =4210752
                    Name ="cmdClose"
                    Caption ="Done"
                    OnClick ="[Event Procedure]"
                    GUID = Begin
                        0x75635e8de0654349923dac138128d05c
                    End
                    GridlineColor =10921638
                    LayoutCachedLeft =6255
                    LayoutCachedTop =120
                    LayoutCachedWidth =7275
                    LayoutCachedHeight =720
                    BackColor =14732154
                    BorderColor =14732154
                    HoverColor =15392166
                    PressedColor =9402914
                    HoverForeColor =4210752
                    PressedForeColor =4210752
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit

Private Sub chkIsPortalUser_AfterUpdate()

   If Me.chkIsPortalUser = True Then
      ' if password is blank, then change to user email
      
      If IsNull(Me.PasswordHash) = True Then
         
         Me.PasswordHash = Me.Email
         Me.txtShowPassword = Me.Email
         
         Me.txtShowPassword.visible = True
         
         Me.Dirty = False
         
      End If
      
      ' add user to web role (both IsWebser and MUST be member of Role = Portal
      Call AddUserToPortal
      
   End If
      
   Call FormatStuff
   
   
End Sub

Private Sub cmdClose_Click()

   DoCmd.Close acForm, Me.name
   
End Sub

Private Sub cmdPassReset_Click()

   Me.PasswordHash = Me.Email
   Me.Dirty = False
   
   Me.txtShowPassword.visible = True
   
End Sub

Private Sub Form_Load()

   ' display last logon
      
   Me.txtLastSeen = GetLastLogOn
   If IsNull(Me.txtLastSeen) Then
      Me.txtLastSeen = "Never"
   End If
   
   Call ShowLastUpLoadInfo
      
      
   Call FormatStuff
   
   
End Sub



Private Function GetLastLogOn() As Variant

   ' returns null if no last logon
   
   Dim rst        As DAO.Recordset
   Dim strSQL     As String
   
   strSQL = "select top 1 ActDate from dbo_Web_Activities where ActDateEnd is not null AND" & _
            " ContactName_id = " & Me!ID & _
            " Order by ActDate DESC, ID"
   Set rst = CurrentDb.OpenRecordset(strSQL)
   
   If rst.EOF = False Then
      GetLastLogOn = rst!ActDate
   End If
   rst.Close

End Function


Private Sub ShowLastUpLoadInfo()

   Dim rst        As DAO.Recordset
   Dim strSQL     As String

   strSQL = "select top 1 DateUploaded, UpLoadFileName from dbo_WebUpload" & _
            " WHERE ContactNameID = " & Me!ID & _
            " Order by DateUploaded DESC, ID"
   Set rst = CurrentDb.OpenRecordset(strSQL)
   
   If rst.EOF = False Then
      Me.txtLastUpload = rst!DateUploaded
      Me.txtLastFile = rst!UpLoadFileName
   End If
   rst.Close

End Sub


Private Sub FormatStuff()

   ' load show everthing based on isportal user
   
   If Me.chkIsPortalUser = True Then
      
      Me.txtPortalActive.BackColor = &H9DBB61
      Me.lstSecurity.visible = True
      
      If Me.Email = Me.txtShowPassword Then
         
         Me.txtShowPassword.visible = True
         
      Else
         Me.txtShowPassword.visible = False
      End If
      
      Call ShowSelectedRoles
   Else
      Me.txtPortalActive.BackColor = &HFFFFFF
      Me.lstSecurity.visible = False
      Me.txtShowPassword.visible = False
   End If

   

End Sub


Private Sub ShowSelectedRoles()

   Dim rstContactRoles     As DAO.Recordset
   Dim strSQL              As String
   
   strSQL = "select * from dbo_Web_UsersInRoles where User_ID = " & Me!ID
   Set rstContactRoles = CurrentDb.OpenRecordset(strSQL, dbOpenDynaset, dbSeeChanges)
   
   Dim iptr    As Integer
   If rstContactRoles.RecordCount <> 0 Then
      For iptr = 1 To Me.lstSecurity.ListCount - 1
         
         ' highlight
         rstContactRoles.FindFirst "Role_ID = " & Me.lstSecurity.Column(0, iptr)
         If rstContactRoles.NoMatch = False Then
            Me.lstSecurity.Selected(iptr) = True
         End If
   
      Next iptr
   End If
   
   rstContactRoles.Close

End Sub



Private Sub AddUserToPortal()
   
   Dim rstRoles      As DAO.Recordset
   Dim strSQL        As String
   
   strSQL = "select * from dbo_Web_UsersInRoles where Role_ID = 1 AND User_ID = " & Me!ID
   Set rstRoles = CurrentDb.OpenRecordset(strSQL, dbOpenDynaset, dbSeeChanges)
   If rstRoles.RecordCount = 0 Then
      ' user is NOT a member of Portal - add
      rstRoles.AddNew
      rstRoles!Role_ID = 1
      rstRoles!User_ID = Me!ID
      rstRoles.Update
   End If
   
   rstRoles.Close

End Sub

Private Sub lstSecurity_AfterUpdate()
   
   Call SetRoles

End Sub


Private Sub SetRoles()

   Dim iptr       As Integer
   Dim RoleID     As Long

   Dim rstContactRoles     As DAO.Recordset
   Dim strSQL              As String
   Dim bolAdd              As Boolean
   
   strSQL = "select * from dbo_Web_UsersInRoles where User_ID = " & Me!ID
   Set rstContactRoles = CurrentDb.OpenRecordset(strSQL, dbOpenDynaset, dbSeeChanges)


   For iptr = 1 To Me.lstSecurity.ListCount - 1
      RoleID = Me.lstSecurity.Column(0, iptr)
      If Me.lstSecurity.Selected(iptr) = True Then
         ' if not in list, add
         bolAdd = False
         If rstContactRoles.RecordCount = 0 Then
            bolAdd = True
         Else
            rstContactRoles.FindFirst "Role_ID = " & Me.lstSecurity.Column(0, iptr)
            If rstContactRoles.NoMatch = True Then
               bolAdd = True
            End If
         End If
         If bolAdd = True Then
            rstContactRoles.AddNew
            rstContactRoles!Role_ID = Me.lstSecurity.Column(0, iptr)
            rstContactRoles!User_ID = Me!ID
            rstContactRoles.Update
         End If
         
      Else
         ' if in list - delete
         If rstContactRoles.RecordCount <> 0 Then
            rstContactRoles.FindFirst "Role_ID = " & Me.lstSecurity.Column(0, iptr)
            If rstContactRoles.NoMatch = False Then
               rstContactRoles.Delete
            End If
         End If
      End If
   Next iptr

   rstContactRoles.Close

End Sub